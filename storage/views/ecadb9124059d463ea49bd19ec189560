<?php $rownum = 1;?>
<table class="table table-striped table-bordered bootstrap-datatable datatable" >
    <colgroup>
        <col style="width: 50px;">
        <col style="width: 150px;">
        <col style="width: 100px;">
        <col>
        <col>
        <col>
        <col>
        <col>
        <col style="width: 125px;">        
    </colgroup>
      <thead>
              <tr>
                  <th style="vertical-align: middle; text-align: center;" >No</th>
                  <th style="vertical-align: middle;text-align: center;" >Tanggal</th>
                  <th style="vertical-align: middle;text-align: center;" >Arus</th>
                  <th style="vertical-align: middle;text-align: center;" >Siswa</th>
                  <th style="vertical-align: middle;text-align: center;" >NIS</th>
                  <th style="vertical-align: middle;text-align: center;" >Rombel</th>
                  <th style="vertical-align: middle;text-align: center;" >Keterangan</th>
                  <th style="vertical-align: middle;text-align: center;" >Total (Rp)</th>
                  <th style="vertical-align: middle;text-align: center;" >Opsi</th>
              </tr>
      </thead>   

      <tbody >
          <?php if(count($trans)>0): ?>
            <?php foreach($trans as $tr): ?>
                <tr id="row_<?php echo  $tr->id ; ?>">
                      <td><?php echo  $rownum++ ; ?></td>
                      <td><?php echo  date('d-m-Y',strtotime($tr->tanggal)) ; ?></td>
                      <td style="text-align: center;">
                          <?php if($tr->arus == 'M'): ?>
                            <span class="label label-success">PENERIMAAN</span>
                          <?php elseif($tr->arus == 'K'): ?>
                            <span class="label label-warning">PENGELUARAN</span>
                          <?php endif; ?>
                      </td>
                      <td>
                          <?php if($tr->siswa): ?>
                            <?php echo  $tr->siswa->nama ; ?>
                          <?php else: ?>
                            -
                          <?php endif; ?>
                      </td>
                      <td>
                          <?php if($tr->siswa): ?>
                            <?php echo  $tr->siswa->nisn ; ?>
                          <?php else: ?>
                            -
                          <?php endif; ?>
                      </td>
                      <td>
                            <?php $sis = $tr->siswa ?>
                            <?php if($sis): ?>
                                <?php echo  $sis->rombels()->where('tahunajaran_id','=',$tr->tahunajaran_id)->first()->nama ; ?>
                            <?php else: ?>
                                -
                            <?php endif; ?>
                          
                      </td>
                      <td>
                          <?php $detrans = $tr->detiltransmasuks; ?>
                          <?php foreach($detrans as $det): ?>
                            <?php if($det->ket != ''): ?>
                                <?php echo  $det->jenisbiaya->nama .'[' . $det->ket . ']' . ', ' ; ?> 
                            <?php else: ?>
                                <?php echo  $det->jenisbiaya->nama . ', ' ; ?> 
                            <?php endif; ?>
                          <?php endforeach; ?>
                          <?php echo  '..' ; ?>
                      </td>
                      <td class="uang" style="text-align: right;" >
                          <?php $total = 0;?>
                          <?php foreach($tr->detiltransmasuks as $det): ?>
                            <?php $total += $det->jumlah; ?>
                          <?php endforeach; ?>
                          <?php echo  $total ; ?>
                      </td>
                      <td>
                          <a class="btn btn-mini btn-success buttonPreview" href="#" idtrans="<?php echo  $tr->id ; ?>" data-rel="tooltip" data-original-title="detil transaksi"><i class="icon-white icon-search"></i></a>
                           <?php if($tr->siswa): ?>
                            <a class=" btn btn-mini btn-info buttonPrint" href="#" idtrans="<?php echo  $tr->id ; ?>" data-rel="tooltip" data-original-title="Cetak Nota"><i class="icon-white icon-print"></i></a>
                          <?php endif; ?>
                          <a class=" btn btn-mini btn-warning btn-delete-trans" href="#" idtrans="<?php echo  $tr->id ; ?>" data-rel="tooltip" data-original-title="Hapus Transaksi"><i class="icon-white icon-trash"></i></a>
                      </td>
                  </tr>
                <?php endforeach; ?>
          <?php else: ?>
<!--                <tr>
                    <td colspan="6" style="text-align: center;">
                        <?php echo  'Tidak ada data yang ditemukan' ; ?>
                    </td>
                </tr>-->
          <?php endif; ?>
      </tbody>
</table>

<script>
    jQuery(document).ready(function(){
            /**
             * Cetak Nota Transaksi
             */
            jQuery('.buttonPrint').click(function(){
                var transaksi_id = jQuery(this).attr('idtrans');
                
                if (confirm('Anda akan mencetak nota untuk transaksi ini?')){
                    var loadUrl = "<?php echo  URL::to('transaksi/histori/cetaknotajzebra') ; ?>";
                    //cetak nota with post
                    jQuery.post(loadUrl, {
                        trans_id : transaksi_id
                    }).done(function(data){
                        //print using jzebra
                        printNota(data);
                        
                        alert('Cetak nota sedang di proses');
//                        jQuery('#ajaxRes').html(data);
                        
                    }).fail(function(data){
                        alert('NOTA GAGAL DICETAK');
//                        jQuery('#ajaxRes').html(data);
                    });
                }
               return false;
            });
            /**
             * Hapus Transaksi
             */
             jQuery('.btn-delete-trans').click(function(){
                var transaksi_id = jQuery(this).attr('idtrans');
                
                if (confirm('Anda akan menghapus data transaksi ini?')){
                    var loadUrl = "<?php echo  URL::to('transaksi/histori/deletetrans') ; ?>";
                    //cetak nota with post
                    jQuery.get(loadUrl, {
                        trans_id : transaksi_id
                    }).done(function(data){
                        alert('.:: INFO ::. Data telah dihapus.');
                        jQuery('#row_'+transaksi_id).hide(500);
                    }).fail(function(data){
                        alert('.:: ERROR ::. Data gagal dihapus.');
                    });
                }
                
                return false;
             });
    });
</script>

<div id="ajaxRes"></div>
    